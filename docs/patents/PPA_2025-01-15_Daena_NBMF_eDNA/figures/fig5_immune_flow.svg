<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="550" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; }
      .label { font-family: Arial, sans-serif; font-size: 11px; }
      .ref-num { font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; }
      .box { fill: #e8f4f8; stroke: #2c5f7d; stroke-width: 2; }
      .threat-box { fill: #ffe6e6; stroke: #dc3545; stroke-width: 2; }
      .action-box { fill: #fff3cd; stroke: #856404; stroke-width: 2; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .threat-arrow { stroke: #dc3545; stroke-width: 2; fill: none; marker-end: url(#arrowhead-red); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dc3545" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" class="title">FIG.5 Immune Detection → Quarantine → Rollback</text>
  
  <!-- Threat Detection -->
  <rect x="50" y="60" width="700" height="120" fill="white" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="400" y="85" text-anchor="middle" class="label" font-weight="bold">Threat Detection</text>
  
  <!-- Threat Detector -->
  <rect x="150" y="100" width="120" height="60" class="threat-box" rx="3"/>
  <text x="210" y="120" text-anchor="middle" class="ref-num">1101</text>
  <text x="210" y="135" text-anchor="middle" class="label" font-weight="bold">Threat Detector</text>
  <text x="210" y="150" text-anchor="middle" class="label" font-size="10px">Monitors system</text>
  
  <!-- Anomaly Detection -->
  <rect x="300" y="100" width="120" height="60" class="threat-box" rx="3"/>
  <text x="360" y="120" text-anchor="middle" class="ref-num">1102</text>
  <text x="360" y="135" text-anchor="middle" class="label" font-weight="bold">Anomaly</text>
  <text x="360" y="150" text-anchor="middle" class="label" font-size="10px">Unusual patterns</text>
  
  <!-- Policy Breach Detector -->
  <rect x="450" y="100" width="120" height="60" class="threat-box" rx="3"/>
  <text x="510" y="120" text-anchor="middle" class="ref-num">1103</text>
  <text x="510" y="135" text-anchor="middle" class="label" font-weight="bold">Policy Breach</text>
  <text x="510" y="150" text-anchor="middle" class="label" font-size="10px">ABAC violations</text>
  
  <!-- Prompt Injection Detector -->
  <rect x="600" y="100" width="120" height="60" class="threat-box" rx="3"/>
  <text x="660" y="120" text-anchor="middle" class="ref-num">1104</text>
  <text x="660" y="135" text-anchor="middle" class="label" font-weight="bold">Prompt Injection</text>
  <text x="660" y="150" text-anchor="middle" class="label" font-size="10px">Malicious inputs</text>
  
  <!-- Detection Arrows -->
  <line x1="270" y1="130" x2="300" y2="130" class="threat-arrow"/>
  <line x1="420" y1="130" x2="450" y2="130" class="threat-arrow"/>
  <line x1="570" y1="130" x2="600" y2="130" class="threat-arrow"/>
  
  <!-- Immune Event Creation -->
  <rect x="300" y="220" width="200" height="60" class="action-box" rx="3"/>
  <text x="400" y="240" text-anchor="middle" class="ref-num">1105</text>
  <text x="400" y="255" text-anchor="middle" class="label" font-weight="bold">Immune Event Created</text>
  <text x="400" y="270" text-anchor="middle" class="label" font-size="10px">Threat level, type, context</text>
  
  <!-- Flow Arrow -->
  <line x1="400" y1="160" x2="400" y2="220" class="threat-arrow"/>
  
  <!-- Response Actions -->
  <rect x="50" y="320" width="700" height="180" fill="white" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="400" y="345" text-anchor="middle" class="label" font-weight="bold">Response Actions</text>
  
  <!-- Quarantine -->
  <rect x="100" y="360" width="140" height="120" class="action-box" rx="3"/>
  <text x="170" y="380" text-anchor="middle" class="ref-num">1106</text>
  <text x="170" y="395" text-anchor="middle" class="label" font-weight="bold">Quarantine</text>
  <text x="170" y="410" text-anchor="middle" class="label" font-size="10px">Block all memory</text>
  <text x="170" y="425" text-anchor="middle" class="label" font-size="10px">operations</text>
  <text x="120" y="445" class="label" font-size="9px">→ L2Q quarantine</text>
  <text x="120" y="458" class="label" font-size="9px">→ Trust threshold ↑</text>
  <text x="120" y="471" class="label" font-size="9px">→ Access blocked</text>
  
  <!-- Quorum Requirement -->
  <rect x="280" y="360" width="140" height="120" class="action-box" rx="3"/>
  <text x="350" y="380" text-anchor="middle" class="ref-num">1107</text>
  <text x="350" y="395" text-anchor="middle" class="label" font-weight="bold">Quorum</text>
  <text x="350" y="410" text-anchor="middle" class="label" font-size="10px">Require multi-agent</text>
  <text x="350" y="425" text-anchor="middle" class="label" font-size="10px">consensus</text>
  <text x="290" y="445" class="label" font-size="9px">→ Min 3 agents</text>
  <text x="290" y="458" class="label" font-size="9px">→ Consensus required</text>
  <text x="290" y="471" class="label" font-size="9px">→ Trust score ↑</text>
  
  <!-- Trust Adjustment -->
  <rect x="460" y="360" width="140" height="120" class="action-box" rx="3"/>
  <text x="530" y="380" text-anchor="middle" class="label" font-weight="bold">Trust Adjustment</text>
  <text x="530" y="395" text-anchor="middle" class="label" font-size="10px">Lower thresholds</text>
  <text x="530" y="410" text-anchor="middle" class="label" font-size="10px">for promotion</text>
  <text x="470" y="430" class="label" font-size="9px">→ Trust threshold ↓</text>
  <text x="470" y="443" class="label" font-size="9px">→ Stricter validation</text>
  <text x="470" y="456" class="label" font-size="9px">→ More rejections</text>
  <text x="470" y="469" class="label" font-size="9px">→ Human review ↑</text>
  
  <!-- Rollback -->
  <rect x="640" y="360" width="110" height="120" class="action-box" rx="3"/>
  <text x="695" y="380" text-anchor="middle" class="ref-num">1108</text>
  <text x="695" y="395" text-anchor="middle" class="label" font-weight="bold">Rollback</text>
  <text x="695" y="410" text-anchor="middle" class="label" font-size="10px">Revert recent</text>
  <text x="695" y="425" text-anchor="middle" class="label" font-size="10px">promotions</text>
  <text x="650" y="445" class="label" font-size="9px">→ L2 → L2Q</text>
  <text x="650" y="458" class="label" font-size="9px">→ L3 → L2</text>
  <text x="650" y="471" class="label" font-size="9px">→ Lineage updated</text>
  
  <!-- Action Flow Arrows -->
  <line x1="400" y1="280" x2="170" y2="360" class="threat-arrow"/>
  <line x1="400" y1="280" x2="350" y2="360" class="threat-arrow"/>
  <line x1="400" y1="280" x2="530" y2="360" class="threat-arrow"/>
  <line x1="400" y1="280" x2="695" y2="360" class="threat-arrow"/>
  
  <!-- NBMF Integration Note -->
  <rect x="50" y="520" width="700" height="25" fill="#e8f4f8" stroke="#2c5f7d" stroke-width="1" rx="3"/>
  <text x="400" y="537" text-anchor="middle" class="label" font-size="10px">NBMF Integration: Immune events trigger L2Q quarantine, TrustManagerV2 adjusts promotion thresholds, rollback demotes records</text>
</svg>










